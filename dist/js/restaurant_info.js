!function(n){var e=window.webpackHotUpdate;window.webpackHotUpdate=function(n,t){!function(n,e){if(!s[n]||!m[n])return;for(var t in m[n]=!1,e)Object.prototype.hasOwnProperty.call(e,t)&&(B[t]=e[t]);0==--o&&0===C&&hotUpdateDownloaded()}(n,t),e&&e(n,t)};var t,c=!0,I="97d65eab11024c819c2b",g=1e4,r={},d=[],i=[];function hotCreateRequire(n){var e=Z[n];if(!e)return __webpack_require__;var c=function(c){return e.hot.active?(Z[c]?-1===Z[c].parents.indexOf(n)&&Z[c].parents.push(n):(d=[n],t=c),-1===e.children.indexOf(c)&&e.children.push(c)):(console.warn("[HMR] unexpected require("+c+") from disposed module "+n),d=[]),__webpack_require__(c)},I=function(n){return{configurable:!0,enumerable:!0,get:function(){return __webpack_require__[n]},set:function(e){__webpack_require__[n]=e}}};for(var g in __webpack_require__)Object.prototype.hasOwnProperty.call(__webpack_require__,g)&&"e"!==g&&"t"!==g&&Object.defineProperty(c,g,I(g));return c.e=function(n){return"ready"===u&&hotSetStatus("prepare"),C++,__webpack_require__.e(n).then(finishChunkLoading,function(n){throw finishChunkLoading(),n});function finishChunkLoading(){C--,"prepare"===u&&(Q[n]||hotEnsureUpdateChunk(n),0===C&&0===o&&hotUpdateDownloaded())}},c.t=function(n,e){return 1&e&&(n=c(n)),__webpack_require__.t(n,-2&e)},c}var l=[],u="idle";function hotSetStatus(n){u=n;for(var e=0;e<l.length;e++)l[e].call(null,n)}var a,B,b,o=0,C=0,Q={},m={},s={};function toModuleId(n){return+n+""===n?+n:n}function hotCheck(n){if("idle"!==u)throw new Error("check() is only allowed in idle status");return c=n,hotSetStatus("check"),function(n){return n=n||1e4,new Promise(function(e,t){if("undefined"==typeof XMLHttpRequest)return t(new Error("No browser support"));try{var c=new XMLHttpRequest,g=__webpack_require__.p+""+I+".hot-update.json";c.open("GET",g,!0),c.timeout=n,c.send(null)}catch(n){return t(n)}c.onreadystatechange=function(){if(4===c.readyState)if(0===c.status)t(new Error("Manifest request to "+g+" timed out."));else if(404===c.status)e();else if(200!==c.status&&304!==c.status)t(new Error("Manifest request to "+g+" failed."));else{try{var n=JSON.parse(c.responseText)}catch(n){return void t(n)}e(n)}}})}(g).then(function(n){if(!n)return hotSetStatus("idle"),null;m={},Q={},s=n.c,b=n.h,hotSetStatus("prepare");var e=new Promise(function(n,e){a={resolve:n,reject:e}});B={};return hotEnsureUpdateChunk(1),"prepare"===u&&0===C&&0===o&&hotUpdateDownloaded(),e})}function hotEnsureUpdateChunk(n){s[n]?(m[n]=!0,o++,function(n){var e=document.getElementsByTagName("head")[0],t=document.createElement("script");t.charset="utf-8",t.src=__webpack_require__.p+""+n+"."+I+".hot-update.js",e.appendChild(t)}(n)):Q[n]=!0}function hotUpdateDownloaded(){hotSetStatus("ready");var n=a;if(a=null,n)if(c)Promise.resolve().then(function(){return hotApply(c)}).then(function(e){n.resolve(e)},function(e){n.reject(e)});else{var e=[];for(var t in B)Object.prototype.hasOwnProperty.call(B,t)&&e.push(toModuleId(t));n.resolve(e)}}function hotApply(e){if("ready"!==u)throw new Error("apply() is only allowed in ready status");var t,c,g,i,l;function getAffectedStuff(n){for(var e=[n],t={},c=e.slice().map(function(n){return{chain:[n],id:n}});c.length>0;){var I=c.pop(),g=I.id,r=I.chain;if((i=Z[g])&&!i.hot._selfAccepted){if(i.hot._selfDeclined)return{type:"self-declined",chain:r,moduleId:g};if(i.hot._main)return{type:"unaccepted",chain:r,moduleId:g};for(var d=0;d<i.parents.length;d++){var l=i.parents[d],u=Z[l];if(u){if(u.hot._declinedDependencies[g])return{type:"declined",chain:r.concat([l]),moduleId:g,parentId:l};-1===e.indexOf(l)&&(u.hot._acceptedDependencies[g]?(t[l]||(t[l]=[]),addAllToSet(t[l],[g])):(delete t[l],e.push(l),c.push({chain:r.concat([l]),id:l})))}}}}return{type:"accepted",moduleId:n,outdatedModules:e,outdatedDependencies:t}}function addAllToSet(n,e){for(var t=0;t<e.length;t++){var c=e[t];-1===n.indexOf(c)&&n.push(c)}}e=e||{};var a={},o=[],C={},Q=function(){console.warn("[HMR] unexpected require("+A.moduleId+") to disposed module")};for(var m in B)if(Object.prototype.hasOwnProperty.call(B,m)){var A;l=toModuleId(m);var G=!1,F=!1,X=!1,p="";switch((A=B[m]?getAffectedStuff(l):{type:"disposed",moduleId:m}).chain&&(p="\nUpdate propagation: "+A.chain.join(" -> ")),A.type){case"self-declined":e.onDeclined&&e.onDeclined(A),e.ignoreDeclined||(G=new Error("Aborted because of self decline: "+A.moduleId+p));break;case"declined":e.onDeclined&&e.onDeclined(A),e.ignoreDeclined||(G=new Error("Aborted because of declined dependency: "+A.moduleId+" in "+A.parentId+p));break;case"unaccepted":e.onUnaccepted&&e.onUnaccepted(A),e.ignoreUnaccepted||(G=new Error("Aborted because "+l+" is not accepted"+p));break;case"accepted":e.onAccepted&&e.onAccepted(A),F=!0;break;case"disposed":e.onDisposed&&e.onDisposed(A),X=!0;break;default:throw new Error("Unexception type "+A.type)}if(G)return hotSetStatus("abort"),Promise.reject(G);if(F)for(l in C[l]=B[l],addAllToSet(o,A.outdatedModules),A.outdatedDependencies)Object.prototype.hasOwnProperty.call(A.outdatedDependencies,l)&&(a[l]||(a[l]=[]),addAllToSet(a[l],A.outdatedDependencies[l]));X&&(addAllToSet(o,[A.moduleId]),C[l]=Q)}var y,U=[];for(c=0;c<o.length;c++)l=o[c],Z[l]&&Z[l].hot._selfAccepted&&U.push({module:l,errorHandler:Z[l].hot._selfAccepted});hotSetStatus("dispose"),Object.keys(s).forEach(function(n){!1===s[n]&&function(n){delete installedChunks[n]}(n)});for(var h,V,N=o.slice();N.length>0;)if(l=N.pop(),i=Z[l]){var W={},R=i.hot._disposeHandlers;for(g=0;g<R.length;g++)(t=R[g])(W);for(r[l]=W,i.hot.active=!1,delete Z[l],delete a[l],g=0;g<i.children.length;g++){var J=Z[i.children[g]];J&&((y=J.parents.indexOf(l))>=0&&J.parents.splice(y,1))}}for(l in a)if(Object.prototype.hasOwnProperty.call(a,l)&&(i=Z[l]))for(V=a[l],g=0;g<V.length;g++)h=V[g],(y=i.children.indexOf(h))>=0&&i.children.splice(y,1);for(l in hotSetStatus("apply"),I=b,C)Object.prototype.hasOwnProperty.call(C,l)&&(n[l]=C[l]);var v=null;for(l in a)if(Object.prototype.hasOwnProperty.call(a,l)&&(i=Z[l])){V=a[l];var H=[];for(c=0;c<V.length;c++)if(h=V[c],t=i.hot._acceptedDependencies[h]){if(-1!==H.indexOf(t))continue;H.push(t)}for(c=0;c<H.length;c++){t=H[c];try{t(V)}catch(n){e.onErrored&&e.onErrored({type:"accept-errored",moduleId:l,dependencyId:V[c],error:n}),e.ignoreErrored||v||(v=n)}}}for(c=0;c<U.length;c++){var T=U[c];l=T.module,d=[l];try{__webpack_require__(l)}catch(n){if("function"==typeof T.errorHandler)try{T.errorHandler(n)}catch(t){e.onErrored&&e.onErrored({type:"self-accept-error-handler-errored",moduleId:l,error:t,originalError:n}),e.ignoreErrored||v||(v=t),v||(v=n)}else e.onErrored&&e.onErrored({type:"self-accept-errored",moduleId:l,error:n}),e.ignoreErrored||v||(v=n)}}return v?(hotSetStatus("fail"),Promise.reject(v)):(hotSetStatus("idle"),new Promise(function(n){n(o)}))}var Z={};function __webpack_require__(e){if(Z[e])return Z[e].exports;var c=Z[e]={i:e,l:!1,exports:{},hot:function(n){var e={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:t!==n,active:!0,accept:function(n,t){if(void 0===n)e._selfAccepted=!0;else if("function"==typeof n)e._selfAccepted=n;else if("object"==typeof n)for(var c=0;c<n.length;c++)e._acceptedDependencies[n[c]]=t||function(){};else e._acceptedDependencies[n]=t||function(){}},decline:function(n){if(void 0===n)e._selfDeclined=!0;else if("object"==typeof n)for(var t=0;t<n.length;t++)e._declinedDependencies[n[t]]=!0;else e._declinedDependencies[n]=!0},dispose:function(n){e._disposeHandlers.push(n)},addDisposeHandler:function(n){e._disposeHandlers.push(n)},removeDisposeHandler:function(n){var t=e._disposeHandlers.indexOf(n);t>=0&&e._disposeHandlers.splice(t,1)},check:hotCheck,apply:hotApply,status:function(n){if(!n)return u;l.push(n)},addStatusHandler:function(n){l.push(n)},removeStatusHandler:function(n){var e=l.indexOf(n);e>=0&&l.splice(e,1)},data:r[n]};return t=void 0,e}(e),parents:(i=d,d=[],i),children:[]};return n[e].call(c.exports,c,c.exports,hotCreateRequire(e)),c.l=!0,c.exports}__webpack_require__.m=n,__webpack_require__.c=Z,__webpack_require__.d=function(n,e,t){__webpack_require__.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:t})},__webpack_require__.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},__webpack_require__.t=function(n,e){if(1&e&&(n=__webpack_require__(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var t=Object.create(null);if(__webpack_require__.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var c in n)__webpack_require__.d(t,c,function(e){return n[e]}.bind(null,c));return t},__webpack_require__.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},__webpack_require__.p="",__webpack_require__.h=function(){return I},hotCreateRequire("../src/js/restaurant_info.js")(__webpack_require__.s="../src/js/restaurant_info.js")}({"../node_modules/idb/lib/idb.js":function(module,exports,__webpack_require__){"use strict";eval("\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      if (request) {\n        request.onupgradeneeded = function(event) {\n          if (upgradeCallback) {\n            upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n          }\n        };\n      }\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (true) {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {}\n}());\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vbm9kZV9tb2R1bGVzL2lkYi9saWIvaWRiLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uL25vZGVfbW9kdWxlcy9pZGIvbGliL2lkYi5qcz9kY2NiIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiB0b0FycmF5KGFycikge1xuICAgIHJldHVybiBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcnIpO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuXG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKSB7XG4gICAgdmFyIHJlcXVlc3Q7XG4gICAgdmFyIHAgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIHJlcXVlc3QgPSBvYmpbbWV0aG9kXS5hcHBseShvYmosIGFyZ3MpO1xuICAgICAgcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgfSk7XG5cbiAgICBwLnJlcXVlc3QgPSByZXF1ZXN0O1xuICAgIHJldHVybiBwO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5Q3Vyc29yUmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcCA9IHByb21pc2lmeVJlcXVlc3RDYWxsKG9iaiwgbWV0aG9kLCBhcmdzKTtcbiAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgcC5yZXF1ZXN0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5UHJvcGVydGllcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eUNsYXNzLnByb3RvdHlwZSwgcHJvcCwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0gPSB2YWw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb3h5TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0aGlzW3RhcmdldFByb3BdW3Byb3BdLmFwcGx5KHRoaXNbdGFyZ2V0UHJvcF0sIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhQcm94eUNsYXNzLCB0YXJnZXRQcm9wLCBDb25zdHJ1Y3RvciwgcHJvcGVydGllcykge1xuICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICBpZiAoIShwcm9wIGluIENvbnN0cnVjdG9yLnByb3RvdHlwZSkpIHJldHVybjtcbiAgICAgIFByb3h5Q2xhc3MucHJvdG90eXBlW3Byb3BdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbCh0aGlzW3RhcmdldFByb3BdLCBwcm9wLCBhcmd1bWVudHMpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIEluZGV4KGluZGV4KSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhJbmRleCwgJ19pbmRleCcsIFtcbiAgICAnbmFtZScsXG4gICAgJ2tleVBhdGgnLFxuICAgICdtdWx0aUVudHJ5JyxcbiAgICAndW5pcXVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnZ2V0JyxcbiAgICAnZ2V0S2V5JyxcbiAgICAnZ2V0QWxsJyxcbiAgICAnZ2V0QWxsS2V5cycsXG4gICAgJ2NvdW50J1xuICBdKTtcblxuICBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKEluZGV4LCAnX2luZGV4JywgSURCSW5kZXgsIFtcbiAgICAnb3BlbkN1cnNvcicsXG4gICAgJ29wZW5LZXlDdXJzb3InXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIEN1cnNvcihjdXJzb3IsIHJlcXVlc3QpIHtcbiAgICB0aGlzLl9jdXJzb3IgPSBjdXJzb3I7XG4gICAgdGhpcy5fcmVxdWVzdCA9IHJlcXVlc3Q7XG4gIH1cblxuICBwcm94eVByb3BlcnRpZXMoQ3Vyc29yLCAnX2N1cnNvcicsIFtcbiAgICAnZGlyZWN0aW9uJyxcbiAgICAna2V5JyxcbiAgICAncHJpbWFyeUtleScsXG4gICAgJ3ZhbHVlJ1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKEN1cnNvciwgJ19jdXJzb3InLCBJREJDdXJzb3IsIFtcbiAgICAndXBkYXRlJyxcbiAgICAnZGVsZXRlJ1xuICBdKTtcblxuICAvLyBwcm94eSAnbmV4dCcgbWV0aG9kc1xuICBbJ2FkdmFuY2UnLCAnY29udGludWUnLCAnY29udGludWVQcmltYXJ5S2V5J10uZm9yRWFjaChmdW5jdGlvbihtZXRob2ROYW1lKSB7XG4gICAgaWYgKCEobWV0aG9kTmFtZSBpbiBJREJDdXJzb3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgIEN1cnNvci5wcm90b3R5cGVbbWV0aG9kTmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBjdXJzb3IgPSB0aGlzO1xuICAgICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgY3Vyc29yLl9jdXJzb3JbbWV0aG9kTmFtZV0uYXBwbHkoY3Vyc29yLl9jdXJzb3IsIGFyZ3MpO1xuICAgICAgICByZXR1cm4gcHJvbWlzaWZ5UmVxdWVzdChjdXJzb3IuX3JlcXVlc3QpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47XG4gICAgICAgICAgcmV0dXJuIG5ldyBDdXJzb3IodmFsdWUsIGN1cnNvci5fcmVxdWVzdCk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcbiAgfSk7XG5cbiAgZnVuY3Rpb24gT2JqZWN0U3RvcmUoc3RvcmUpIHtcbiAgICB0aGlzLl9zdG9yZSA9IHN0b3JlO1xuICB9XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmNyZWF0ZUluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5jcmVhdGVJbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgT2JqZWN0U3RvcmUucHJvdG90eXBlLmluZGV4ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBJbmRleCh0aGlzLl9zdG9yZS5pbmRleC5hcHBseSh0aGlzLl9zdG9yZSwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ2luZGV4TmFtZXMnLFxuICAgICdhdXRvSW5jcmVtZW50J1xuICBdKTtcblxuICBwcm94eVJlcXVlc3RNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAncHV0JyxcbiAgICAnYWRkJyxcbiAgICAnZGVsZXRlJyxcbiAgICAnY2xlYXInLFxuICAgICdnZXQnLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKE9iamVjdFN0b3JlLCAnX3N0b3JlJywgSURCT2JqZWN0U3RvcmUsIFtcbiAgICAnZGVsZXRlSW5kZXgnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFRyYW5zYWN0aW9uKGlkYlRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fdHggPSBpZGJUcmFuc2FjdGlvbjtcbiAgICB0aGlzLmNvbXBsZXRlID0gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgICAgaWRiVHJhbnNhY3Rpb24ub25hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QoaWRiVHJhbnNhY3Rpb24uZXJyb3IpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIFRyYW5zYWN0aW9uLnByb3RvdHlwZS5vYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fdHgub2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fdHgsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhUcmFuc2FjdGlvbiwgJ190eCcsIFtcbiAgICAnb2JqZWN0U3RvcmVOYW1lcycsXG4gICAgJ21vZGUnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhUcmFuc2FjdGlvbiwgJ190eCcsIElEQlRyYW5zYWN0aW9uLCBbXG4gICAgJ2Fib3J0J1xuICBdKTtcblxuICBmdW5jdGlvbiBVcGdyYWRlREIoZGIsIG9sZFZlcnNpb24sIHRyYW5zYWN0aW9uKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgICB0aGlzLm9sZFZlcnNpb24gPSBvbGRWZXJzaW9uO1xuICAgIHRoaXMudHJhbnNhY3Rpb24gPSBuZXcgVHJhbnNhY3Rpb24odHJhbnNhY3Rpb24pO1xuICB9XG5cbiAgVXBncmFkZURCLnByb3RvdHlwZS5jcmVhdGVPYmplY3RTdG9yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgT2JqZWN0U3RvcmUodGhpcy5fZGIuY3JlYXRlT2JqZWN0U3RvcmUuYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhVcGdyYWRlREIsICdfZGInLCBbXG4gICAgJ25hbWUnLFxuICAgICd2ZXJzaW9uJyxcbiAgICAnb2JqZWN0U3RvcmVOYW1lcydcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFVwZ3JhZGVEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2RlbGV0ZU9iamVjdFN0b3JlJyxcbiAgICAnY2xvc2UnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIERCKGRiKSB7XG4gICAgdGhpcy5fZGIgPSBkYjtcbiAgfVxuXG4gIERCLnByb3RvdHlwZS50cmFuc2FjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgVHJhbnNhY3Rpb24odGhpcy5fZGIudHJhbnNhY3Rpb24uYXBwbHkodGhpcy5fZGIsIGFyZ3VtZW50cykpO1xuICB9O1xuXG4gIHByb3h5UHJvcGVydGllcyhEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoREIsICdfZGInLCBJREJEYXRhYmFzZSwgW1xuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgLy8gQWRkIGN1cnNvciBpdGVyYXRvcnNcbiAgLy8gVE9ETzogcmVtb3ZlIHRoaXMgb25jZSBicm93c2VycyBkbyB0aGUgcmlnaHQgdGhpbmcgd2l0aCBwcm9taXNlc1xuICBbJ29wZW5DdXJzb3InLCAnb3BlbktleUN1cnNvciddLmZvckVhY2goZnVuY3Rpb24oZnVuY05hbWUpIHtcbiAgICBbT2JqZWN0U3RvcmUsIEluZGV4XS5mb3JFYWNoKGZ1bmN0aW9uKENvbnN0cnVjdG9yKSB7XG4gICAgICAvLyBEb24ndCBjcmVhdGUgaXRlcmF0ZUtleUN1cnNvciBpZiBvcGVuS2V5Q3Vyc29yIGRvZXNuJ3QgZXhpc3QuXG4gICAgICBpZiAoIShmdW5jTmFtZSBpbiBDb25zdHJ1Y3Rvci5wcm90b3R5cGUpKSByZXR1cm47XG5cbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcbiAgICAgICAgdmFyIG5hdGl2ZU9iamVjdCA9IHRoaXMuX3N0b3JlIHx8IHRoaXMuX2luZGV4O1xuICAgICAgICB2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gcG9seWZpbGwgZ2V0QWxsXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbihxdWVyeSwgY291bnQpIHtcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG4gICAgICB2YXIgaXRlbXMgPSBbXTtcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cbiAgICAgICAgICBpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICB2YXIgZXhwID0ge1xuICAgIG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG4gICAgICBpZiAocmVxdWVzdCkge1xuICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgaWYgKHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgICAgICAgdXBncmFkZUNhbGxiYWNrKG5ldyBVcGdyYWRlREIocmVxdWVzdC5yZXN1bHQsIGV2ZW50Lm9sZFZlcnNpb24sIHJlcXVlc3QudHJhbnNhY3Rpb24pKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24oZGIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEQihkYik7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbGV0ZTogZnVuY3Rpb24obmFtZSkge1xuICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKGluZGV4ZWREQiwgJ2RlbGV0ZURhdGFiYXNlJywgW25hbWVdKTtcbiAgICB9XG4gIH07XG5cbiAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBleHA7XG4gICAgbW9kdWxlLmV4cG9ydHMuZGVmYXVsdCA9IG1vZHVsZS5leHBvcnRzO1xuICB9XG4gIGVsc2Uge1xuICAgIHNlbGYuaWRiID0gZXhwO1xuICB9XG59KCkpO1xuIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUVBO0FBQ0E7Iiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../node_modules/idb/lib/idb.js\n")},"../src/js/dbhelper.js":function(module,exports,__webpack_require__){"use strict";eval("\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _idb = _interopRequireDefault(__webpack_require__(\"../node_modules/idb/lib/idb.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar DATABASE = 'mwdb';\nvar RESTAURANTS_STORE = 'mw_restaurants';\nvar REVIEWS_STORE = 'mw_reviews';\n\nvar getStore = function getStore(storeName, mode) {\n  return function (dbService) {\n    return dbService.then(function (db) {\n      var tx = db.transaction(storeName, mode);\n      var store = tx.objectStore(storeName);\n      return store;\n    });\n  };\n};\n\nvar idbKeyval = {\n  get: function get(storeName, key) {\n    var indexBy = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'by-id';\n    return DBHelper.dbPromise().then(function (db) {\n      return db.transaction(storeName).objectStore(storeName).index(indexBy).get(key);\n    });\n  },\n  getItems: function getItems(storeName, key) {\n    var indexBy = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'by-id';\n    return DBHelper.dbPromise().then(function (db) {\n      return db.transaction(storeName).objectStore(storeName).index(indexBy).getAll(key);\n    });\n  },\n  set: function set(storeName, key, val) {\n    return DBHelper.dbPromise().then(function (db) {\n      var tx = db.transaction(storeName, 'readwrite');\n      var store = tx.objectStore(storeName);\n\n      if (Array.isArray(val)) {\n        val.forEach(function (item) {\n          store.put(item);\n        });\n      } else {\n        store.put(val);\n      }\n\n      return tx.complete;\n    });\n  },\n  delete: function _delete(storeName, key) {\n    return DBHelper.dbPromise().then(function (db) {\n      var tx = db.transaction(storeName, 'readwrite');\n      tx.objectStore(storeName).delete(key);\n      return tx.complete;\n    });\n  },\n  clear: function clear(storeName) {\n    return DBHelper.dbPromise().then(function (db) {\n      var tx = db.transaction(storeName, 'readwrite');\n      tx.objectStore(storeName).clear();\n      return tx.complete;\n    });\n  },\n  keys: function keys(storeName) {\n    return DBHelper.dbPromise().then(function (db) {\n      var tx = db.transaction(storeName);\n      var keys = [];\n      var store = tx.objectStore(storeName);\n      (store.iterateKeyCursor || store.iterateCursor).call(store, function (cursor) {\n        if (!cursor) return;\n        keys.push(cursor.key);\n        cursor.continue();\n      });\n      return tx.complete.then(function () {\n        return keys;\n      });\n    });\n  },\n  getAll: function getAll(storeName) {\n    var indexBy = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'by-id';\n    return DBHelper.dbPromise().then(function (db) {\n      var storeIndex = db.transaction(storeName).objectStore(storeName).index(indexBy);\n      return storeIndex.getAll();\n    }).then(function (data) {\n      return data;\n    });\n  }\n};\n/**\n * Common database helper functions.\n */\n\nvar DBHelper =\n/*#__PURE__*/\nfunction () {\n  function DBHelper() {\n    var port = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1337;\n\n    _classCallCheck(this, DBHelper);\n\n    this.port = port;\n  }\n\n  _createClass(DBHelper, [{\n    key: \"dataBaseUrls\",\n    value: function dataBaseUrls() {\n      var _this = this;\n\n      return {\n        list: \"http://localhost:\".concat(this.port, \"/restaurants\"),\n        byId: function byId(id) {\n          return \"http://localhost:\".concat(_this.port, \"/restaurants/\").concat(id);\n        },\n        restaurantReviews: function restaurantReviews(id) {\n          return \"http://localhost:\".concat(_this.port, \"/reviews?restaurant_id=\").concat(id);\n        },\n        reviews: \"http://localhost:\".concat(this.port, \"/reviews/\")\n      };\n    }\n  }, {\n    key: \"fetchRestaurants\",\n\n    /**\n     * Fetch all restaurants.\n     */\n    value: function fetchRestaurants() {\n      var DBurl = this.dataBaseUrls().list;\n      return idbKeyval.getAll(RESTAURANTS_STORE).then(function (data) {\n        if (data != null && data && data.length > 0) {\n          return data;\n        } else {\n          return fetch(DBurl).then(function (response) {\n            return response.json();\n          }).then(function (data) {\n            /* eslint-disable no-console */\n            console.log(data);\n            /* eslint-enable no-console */\n\n            var restaurants = data;\n            DBHelper.addIndexedDb(RESTAURANTS_STORE, restaurants);\n            return restaurants;\n          });\n        }\n      }).then(function (responseJSON) {\n        return responseJSON;\n      });\n    }\n    /**\n     * Fetch a restaurant by its ID.\n     */\n\n  }, {\n    key: \"fetchRestaurantById\",\n    value: function fetchRestaurantById(id) {\n      var _this2 = this;\n\n      return idbKeyval.get(RESTAURANTS_STORE, Number(id)).then(function (restaurant) {\n        if (!restaurant) {\n          var DBurl = _this2.dataBaseUrls().byId(id);\n\n          return fetch(DBurl).then(function (response) {\n            return response.json();\n          });\n        }\n\n        return restaurant;\n      });\n    }\n    /**\n    * Update the favorite restaurant.\n    */\n\n  }, {\n    key: \"updateFavorite\",\n    value: function updateFavorite(restaurantId, isFav) {\n      var DBurl = this.dataBaseUrls().byId(restaurantId);\n      DBurl += '/?is_favorite=' + isFav;\n      fetch(DBurl, {\n        method: 'PUT'\n      }).then(function () {\n        idbKeyval.get(RESTAURANTS_STORE, Number(restaurantId)).then(function (restaurant) {\n          if (restaurant) {\n            restaurant.is_favorite = isFav;\n            idbKeyval.set(RESTAURANTS_STORE, Number(restaurantId), restaurant);\n          }\n        });\n      }).catch(function () {\n        idbKeyval.get(RESTAURANTS_STORE, Number(restaurantId)).then(function (restaurant) {\n          if (restaurant) {\n            restaurant.synced = 0;\n            restaurant.is_favorite = isFav;\n            idbKeyval.set(RESTAURANTS_STORE, Number(restaurantId), restaurant);\n          }\n        });\n      });\n    }\n    /**\n     * Fetch restaurants by a cuisine type with proper error handling.\n     */\n\n  }, {\n    key: \"fetchRestaurantByCuisine\",\n    value: function fetchRestaurantByCuisine(cuisine) {\n      // Fetch all restaurants  with proper error handling\n      return this.fetchRestaurants().then(function (restaurants) {\n        return restaurants.filter(function (restaurant) {\n          return restaurant.cuisine_type === cuisine;\n        });\n      });\n    }\n    /**\n     * Fetch restaurants by a neighborhood with proper error handling.\n     */\n\n  }, {\n    key: \"fetchRestaurantByNeighborhood\",\n    value: function fetchRestaurantByNeighborhood(neighborhood) {\n      // Fetch all restaurants\n      return this.fetchRestaurants().then(function (restaurants) {\n        return restaurants.filter(function (restaurant) {\n          return restaurant.neighborhood === neighborhood;\n        });\n      });\n    }\n    /**\n     * Fetch restaurants by a neighborhood with proper error handling.\n     */\n\n  }, {\n    key: \"fetchRestaurantByCuisineAndNeighborhood\",\n    value: function fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood) {\n      // Fetch all restaurants\n      return this.fetchRestaurants().then(function (restaurants) {\n        var results = restaurants;\n\n        if (cuisine !== 'all') {\n          // filter by cuisine\n          results = results.filter(function (r) {\n            return r.cuisine_type === cuisine;\n          });\n        }\n\n        if (neighborhood !== 'all') {\n          // filter by neighborhood\n          results = results.filter(function (r) {\n            return r.neighborhood === neighborhood;\n          });\n        }\n\n        return results;\n      });\n    }\n    /**\n     * Fetch all neighborhoods with proper error handling.\n     */\n\n  }, {\n    key: \"fetchNeighborhoods\",\n    value: function fetchNeighborhoods() {\n      // Fetch all restaurants\n      return this.fetchRestaurants().then(function (restaurants) {\n        var neighborhoods = restaurants.map(function (v, i) {\n          return restaurants[i].neighborhood;\n        });\n        return neighborhoods.filter(function (v, i) {\n          return neighborhoods.indexOf(v) === i;\n        });\n      });\n    }\n    /**\n     * Fetch all cuisines with proper error handling.\n     */\n\n  }, {\n    key: \"fetchCuisines\",\n    value: function fetchCuisines() {\n      // Fetch all restaurants\n      return this.fetchRestaurants().then(function (restaurants) {\n        // Get all cuisines from all restaurants\n        var cuisines = restaurants.map(function (v, i) {\n          return restaurants[i].cuisine_type;\n        }); // Remove duplicates from cuisines\n\n        return cuisines.filter(function (v, i) {\n          return cuisines.indexOf(v) === i;\n        });\n      });\n    }\n    /**\n     * Restaurant page URL.\n     */\n\n  }, {\n    key: \"urlForRestaurant\",\n    value: function urlForRestaurant(restaurant) {\n      return \"./restaurant.html?id=\".concat(restaurant.id);\n    }\n    /**\n     * Restaurant image URL.\n     */\n\n  }, {\n    key: \"imageUrlForRestaurant\",\n    value: function imageUrlForRestaurant(restaurant, type) {\n      return type ? \"/img/thumbs/\".concat(restaurant.id, \"-248.jpg\") : \"/img/\".concat(restaurant.id, \".webp\");\n    } // Fetch reviews by Id.\n\n  }, {\n    key: \"fetchReviewsByRestId\",\n    value: function fetchReviewsByRestId(restaurantId) {\n      var DBurl = this.dataBaseUrls().restaurantReviews(restaurantId);\n      return fetch(DBurl).then(function (response) {\n        return response.json();\n      }).then(function (reviews) {\n        idbKeyval.set(REVIEWS_STORE, Number(restaurantId), reviews);\n        return Promise.resolve(reviews);\n      }).catch(function () {\n        return idbKeyval.getItems(REVIEWS_STORE, Number(restaurantId), 'restaurants').then(function (reviews) {\n          //console.error(error);\n          return Promise.resolve(reviews);\n        });\n      });\n    }\n    /**\n     * Map marker for a restaurant.\n     */\n\n  }, {\n    key: \"mapMarkerForRestaurant\",\n    value: function mapMarkerForRestaurant(restaurant, map) {\n      var marker = L.marker([restaurant.latlng.lat, restaurant.latlng.lng], {\n        title: restaurant.name,\n        bounceOnAdd: true,\n        bounceOnAddOptions: {\n          duration: 500,\n          height: 100\n        }\n      }).addTo(map);\n      marker.bindPopup(\"<a href=\\\"\".concat(this.urlForRestaurant(restaurant), \"\\\">\").concat(restaurant.name, \"</a>\"));\n      return marker;\n    }\n  }, {\n    key: \"addReview\",\n\n    /**\n     *\n     */\n    value: function addReview(review) {\n      return DBHelper.addOnlineReview(review);\n    }\n  }], [{\n    key: \"dbPromise\",\n    value: function dbPromise() {\n      return _idb.default.open(DATABASE, 1, function (upgradeDb) {\n        if (!upgradeDb.objectStoreNames.contains(RESTAURANTS_STORE)) {\n          var store = upgradeDb.createObjectStore(RESTAURANTS_STORE, {\n            keyPath: 'id'\n          });\n          store.createIndex('by-id', 'id');\n          store.createIndex('synced', 'synced', {\n            unique: false\n          });\n        }\n\n        if (!upgradeDb.objectStoreNames.contains(REVIEWS_STORE)) {\n          var reviews = upgradeDb.createObjectStore(REVIEWS_STORE, {\n            keyPath: 'id'\n          });\n          reviews.createIndex('by-id', 'id');\n          reviews.createIndex('restaurants', 'restaurant_id', {\n            unique: false\n          });\n          reviews.createIndex('synced', 'synced', {\n            unique: false\n          });\n        }\n      });\n    }\n    /**\n     * Create indexedDB and add the items from the server\n     */\n\n  }, {\n    key: \"addIndexedDb\",\n    value: function addIndexedDb(type, items) {\n      DBHelper.dbPromise().then(function (db) {\n        var tx = db.transaction(type, 'readwrite');\n        var store = tx.objectStore(type);\n        items.forEach(function (item) {\n          return store.put(item);\n        });\n        return tx.complete.then(function () {\n          return Promise.resolve(items);\n        });\n      });\n    } // Get stored object by Id.\n\n  }, {\n    key: \"getStoredObjectById\",\n    value: function getStoredObjectById(dbService, storename, id) {\n      var store = getStore(storename)(dbService);\n      return store.get(id);\n    }\n  }, {\n    key: \"addOnlineReview\",\n    value: function addOnlineReview(review) {\n      var offlineObj = {\n        name: 'addReview',\n        data: review,\n        object_type: 'review'\n      };\n\n      if (!navigator.onLine && offlineObj.name === 'addReview') {\n        DBHelper.sendDataWhenOnline(offlineObj);\n        return;\n      }\n\n      var sendReview = {\n        'restaurant_id': parseInt(review.restaurant_id),\n        'name': review.name,\n        'createdAt': new Date(),\n        'updatedAt': new Date(),\n        'rating': parseInt(review.rating),\n        'comments': review.comments\n      };\n      var fetch_option = {\n        method: 'POST',\n        body: JSON.stringify(sendReview),\n        headers: new Headers({\n          'Content-Type': 'application/json'\n        })\n      };\n      var DBurl = 'http://localhost:1337/reviews/';\n      fetch(DBurl, fetch_option).then(function (response) {\n        if (response.headers.get('content-type').indexOf('application/json') > -1) {\n          return response.json();\n        } else {\n          return 'API call succeeded';\n        }\n      }).then(function (data) {\n        return data;\n      }).catch(function (err) {\n        return \"Error: \".concat(err);\n      });\n    }\n  }, {\n    key: \"sendDataWhenOnline\",\n    value: function sendDataWhenOnline(offlineObj) {\n      localStorage.setItem('data', JSON.stringify(offlineObj.data));\n      window.addEventListener('online', function (event) {\n        var data = JSON.parse(localStorage.getItem('data'));\n\n        if (data) {\n          if (offlineObj.name === 'addReview') {\n            DBHelper.addOnlineReview(offlineObj.data);\n          }\n\n          localStorage.removeItem('data');\n        }\n\n        event.preventDefault();\n      });\n    }\n  }]);\n\n  return DBHelper;\n}();\n\nwindow.addEventListener('online', function (event) {\n  event.preventDefault();\n  displayToast(event.type);\n});\nwindow.addEventListener('offline', function (event) {\n  event.preventDefault();\n  displayToast(event.type);\n});\n\nvar displayToast = function displayToast(type) {\n  var message = '<span>Unable to connect. Retrying…</span>',\n      isVisible = 'none';\n\n  if (type === 'online') {\n    isVisible = 'none';\n  } else {\n    isVisible = 'block';\n  }\n\n  var toast = document.querySelector('#toast');\n  toast.innerHTML = message;\n  toast.style.display = isVisible;\n};\n\nvar _default = new DBHelper();\n\nexports.default = _default;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc3JjL2pzL2RiaGVscGVyLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4uL3NyYy9qcy9kYmhlbHBlci5qcz9mMmI3Il0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwO1xuXG52YXIgX2lkYiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImlkYlwiKSk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgeyB2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldOyBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7IGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsgaWYgKFwidmFsdWVcIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH1cblxuZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOyByZXR1cm4gQ29uc3RydWN0b3I7IH1cblxudmFyIERBVEFCQVNFID0gJ213ZGInO1xudmFyIFJFU1RBVVJBTlRTX1NUT1JFID0gJ213X3Jlc3RhdXJhbnRzJztcbnZhciBSRVZJRVdTX1NUT1JFID0gJ213X3Jldmlld3MnO1xuXG52YXIgZ2V0U3RvcmUgPSBmdW5jdGlvbiBnZXRTdG9yZShzdG9yZU5hbWUsIG1vZGUpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChkYlNlcnZpY2UpIHtcbiAgICByZXR1cm4gZGJTZXJ2aWNlLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICB2YXIgdHggPSBkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIG1vZGUpO1xuICAgICAgdmFyIHN0b3JlID0gdHgub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcbiAgICAgIHJldHVybiBzdG9yZTtcbiAgICB9KTtcbiAgfTtcbn07XG5cbnZhciBpZGJLZXl2YWwgPSB7XG4gIGdldDogZnVuY3Rpb24gZ2V0KHN0b3JlTmFtZSwga2V5KSB7XG4gICAgdmFyIGluZGV4QnkgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6ICdieS1pZCc7XG4gICAgcmV0dXJuIERCSGVscGVyLmRiUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICByZXR1cm4gZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lKS5vYmplY3RTdG9yZShzdG9yZU5hbWUpLmluZGV4KGluZGV4QnkpLmdldChrZXkpO1xuICAgIH0pO1xuICB9LFxuICBnZXRJdGVtczogZnVuY3Rpb24gZ2V0SXRlbXMoc3RvcmVOYW1lLCBrZXkpIHtcbiAgICB2YXIgaW5kZXhCeSA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogJ2J5LWlkJztcbiAgICByZXR1cm4gREJIZWxwZXIuZGJQcm9taXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcbiAgICAgIHJldHVybiBkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUpLm9iamVjdFN0b3JlKHN0b3JlTmFtZSkuaW5kZXgoaW5kZXhCeSkuZ2V0QWxsKGtleSk7XG4gICAgfSk7XG4gIH0sXG4gIHNldDogZnVuY3Rpb24gc2V0KHN0b3JlTmFtZSwga2V5LCB2YWwpIHtcbiAgICByZXR1cm4gREJIZWxwZXIuZGJQcm9taXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcbiAgICAgIHZhciB0eCA9IGRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgJ3JlYWR3cml0ZScpO1xuICAgICAgdmFyIHN0b3JlID0gdHgub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcblxuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsKSkge1xuICAgICAgICB2YWwuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgIHN0b3JlLnB1dChpdGVtKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdG9yZS5wdXQodmFsKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xuICAgIH0pO1xuICB9LFxuICBkZWxldGU6IGZ1bmN0aW9uIF9kZWxldGUoc3RvcmVOYW1lLCBrZXkpIHtcbiAgICByZXR1cm4gREJIZWxwZXIuZGJQcm9taXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcbiAgICAgIHZhciB0eCA9IGRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgJ3JlYWR3cml0ZScpO1xuICAgICAgdHgub2JqZWN0U3RvcmUoc3RvcmVOYW1lKS5kZWxldGUoa2V5KTtcbiAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcbiAgICB9KTtcbiAgfSxcbiAgY2xlYXI6IGZ1bmN0aW9uIGNsZWFyKHN0b3JlTmFtZSkge1xuICAgIHJldHVybiBEQkhlbHBlci5kYlByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xuICAgICAgdmFyIHR4ID0gZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCAncmVhZHdyaXRlJyk7XG4gICAgICB0eC5vYmplY3RTdG9yZShzdG9yZU5hbWUpLmNsZWFyKCk7XG4gICAgICByZXR1cm4gdHguY29tcGxldGU7XG4gICAgfSk7XG4gIH0sXG4gIGtleXM6IGZ1bmN0aW9uIGtleXMoc3RvcmVOYW1lKSB7XG4gICAgcmV0dXJuIERCSGVscGVyLmRiUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICB2YXIgdHggPSBkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUpO1xuICAgICAgdmFyIGtleXMgPSBbXTtcbiAgICAgIHZhciBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XG4gICAgICAoc3RvcmUuaXRlcmF0ZUtleUN1cnNvciB8fCBzdG9yZS5pdGVyYXRlQ3Vyc29yKS5jYWxsKHN0b3JlLCBmdW5jdGlvbiAoY3Vyc29yKSB7XG4gICAgICAgIGlmICghY3Vyc29yKSByZXR1cm47XG4gICAgICAgIGtleXMucHVzaChjdXJzb3Iua2V5KTtcbiAgICAgICAgY3Vyc29yLmNvbnRpbnVlKCk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0eC5jb21wbGV0ZS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGtleXM7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSxcbiAgZ2V0QWxsOiBmdW5jdGlvbiBnZXRBbGwoc3RvcmVOYW1lKSB7XG4gICAgdmFyIGluZGV4QnkgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6ICdieS1pZCc7XG4gICAgcmV0dXJuIERCSGVscGVyLmRiUHJvbWlzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XG4gICAgICB2YXIgc3RvcmVJbmRleCA9IGRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSkub2JqZWN0U3RvcmUoc3RvcmVOYW1lKS5pbmRleChpbmRleEJ5KTtcbiAgICAgIHJldHVybiBzdG9yZUluZGV4LmdldEFsbCgpO1xuICAgIH0pLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgIHJldHVybiBkYXRhO1xuICAgIH0pO1xuICB9XG59O1xuLyoqXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cbiAqL1xuXG52YXIgREJIZWxwZXIgPVxuLyojX19QVVJFX18qL1xuZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBEQkhlbHBlcigpIHtcbiAgICB2YXIgcG9ydCA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogMTMzNztcblxuICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBEQkhlbHBlcik7XG5cbiAgICB0aGlzLnBvcnQgPSBwb3J0O1xuICB9XG5cbiAgX2NyZWF0ZUNsYXNzKERCSGVscGVyLCBbe1xuICAgIGtleTogXCJkYXRhQmFzZVVybHNcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZGF0YUJhc2VVcmxzKCkge1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbGlzdDogXCJodHRwOi8vbG9jYWxob3N0OlwiLmNvbmNhdCh0aGlzLnBvcnQsIFwiL3Jlc3RhdXJhbnRzXCIpLFxuICAgICAgICBieUlkOiBmdW5jdGlvbiBieUlkKGlkKSB7XG4gICAgICAgICAgcmV0dXJuIFwiaHR0cDovL2xvY2FsaG9zdDpcIi5jb25jYXQoX3RoaXMucG9ydCwgXCIvcmVzdGF1cmFudHMvXCIpLmNvbmNhdChpZCk7XG4gICAgICAgIH0sXG4gICAgICAgIHJlc3RhdXJhbnRSZXZpZXdzOiBmdW5jdGlvbiByZXN0YXVyYW50UmV2aWV3cyhpZCkge1xuICAgICAgICAgIHJldHVybiBcImh0dHA6Ly9sb2NhbGhvc3Q6XCIuY29uY2F0KF90aGlzLnBvcnQsIFwiL3Jldmlld3M/cmVzdGF1cmFudF9pZD1cIikuY29uY2F0KGlkKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmV2aWV3czogXCJodHRwOi8vbG9jYWxob3N0OlwiLmNvbmNhdCh0aGlzLnBvcnQsIFwiL3Jldmlld3MvXCIpXG4gICAgICB9O1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogXCJmZXRjaFJlc3RhdXJhbnRzXCIsXG5cbiAgICAvKipcbiAgICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXG4gICAgICovXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudHMoKSB7XG4gICAgICB2YXIgREJ1cmwgPSB0aGlzLmRhdGFCYXNlVXJscygpLmxpc3Q7XG4gICAgICByZXR1cm4gaWRiS2V5dmFsLmdldEFsbChSRVNUQVVSQU5UU19TVE9SRSkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICBpZiAoZGF0YSAhPSBudWxsICYmIGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIGZldGNoKERCdXJsKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgICAgIC8qIGVzbGludC1lbmFibGUgbm8tY29uc29sZSAqL1xuXG4gICAgICAgICAgICB2YXIgcmVzdGF1cmFudHMgPSBkYXRhO1xuICAgICAgICAgICAgREJIZWxwZXIuYWRkSW5kZXhlZERiKFJFU1RBVVJBTlRTX1NUT1JFLCByZXN0YXVyYW50cyk7XG4gICAgICAgICAgICByZXR1cm4gcmVzdGF1cmFudHM7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlSlNPTikge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2VKU09OO1xuICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJmZXRjaFJlc3RhdXJhbnRCeUlkXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQpIHtcbiAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICByZXR1cm4gaWRiS2V5dmFsLmdldChSRVNUQVVSQU5UU19TVE9SRSwgTnVtYmVyKGlkKSkudGhlbihmdW5jdGlvbiAocmVzdGF1cmFudCkge1xuICAgICAgICBpZiAoIXJlc3RhdXJhbnQpIHtcbiAgICAgICAgICB2YXIgREJ1cmwgPSBfdGhpczIuZGF0YUJhc2VVcmxzKCkuYnlJZChpZCk7XG5cbiAgICAgICAgICByZXR1cm4gZmV0Y2goREJ1cmwpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnQ7XG4gICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgKiBVcGRhdGUgdGhlIGZhdm9yaXRlIHJlc3RhdXJhbnQuXG4gICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcInVwZGF0ZUZhdm9yaXRlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHVwZGF0ZUZhdm9yaXRlKHJlc3RhdXJhbnRJZCwgaXNGYXYpIHtcbiAgICAgIHZhciBEQnVybCA9IHRoaXMuZGF0YUJhc2VVcmxzKCkuYnlJZChyZXN0YXVyYW50SWQpO1xuICAgICAgREJ1cmwgKz0gJy8/aXNfZmF2b3JpdGU9JyArIGlzRmF2O1xuICAgICAgZmV0Y2goREJ1cmwsIHtcbiAgICAgICAgbWV0aG9kOiAnUFVUJ1xuICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlkYktleXZhbC5nZXQoUkVTVEFVUkFOVFNfU1RPUkUsIE51bWJlcihyZXN0YXVyYW50SWQpKS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50KSB7XG4gICAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHtcbiAgICAgICAgICAgIHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSBpc0ZhdjtcbiAgICAgICAgICAgIGlkYktleXZhbC5zZXQoUkVTVEFVUkFOVFNfU1RPUkUsIE51bWJlcihyZXN0YXVyYW50SWQpLCByZXN0YXVyYW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICBpZGJLZXl2YWwuZ2V0KFJFU1RBVVJBTlRTX1NUT1JFLCBOdW1iZXIocmVzdGF1cmFudElkKSkudGhlbihmdW5jdGlvbiAocmVzdGF1cmFudCkge1xuICAgICAgICAgIGlmIChyZXN0YXVyYW50KSB7XG4gICAgICAgICAgICByZXN0YXVyYW50LnN5bmNlZCA9IDA7XG4gICAgICAgICAgICByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gaXNGYXY7XG4gICAgICAgICAgICBpZGJLZXl2YWwuc2V0KFJFU1RBVVJBTlRTX1NUT1JFLCBOdW1iZXIocmVzdGF1cmFudElkKSwgcmVzdGF1cmFudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZVwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSkge1xuICAgICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xuICAgICAgcmV0dXJuIHRoaXMuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIHJldHVybiByZXN0YXVyYW50cy5maWx0ZXIoZnVuY3Rpb24gKHJlc3RhdXJhbnQpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGUgPT09IGN1aXNpbmU7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2RcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kKSB7XG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICAgIHJldHVybiB0aGlzLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50cykge1xuICAgICAgICByZXR1cm4gcmVzdGF1cmFudHMuZmlsdGVyKGZ1bmN0aW9uIChyZXN0YXVyYW50KSB7XG4gICAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnQubmVpZ2hib3Job29kID09PSBuZWlnaGJvcmhvb2Q7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QpIHtcbiAgICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgICAgcmV0dXJuIHRoaXMuZmV0Y2hSZXN0YXVyYW50cygpLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnRzKSB7XG4gICAgICAgIHZhciByZXN1bHRzID0gcmVzdGF1cmFudHM7XG5cbiAgICAgICAgaWYgKGN1aXNpbmUgIT09ICdhbGwnKSB7XG4gICAgICAgICAgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgIHJldHVybiByLmN1aXNpbmVfdHlwZSA9PT0gY3Vpc2luZTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT09ICdhbGwnKSB7XG4gICAgICAgICAgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgcmV0dXJuIHIubmVpZ2hib3Job29kID09PSBuZWlnaGJvcmhvb2Q7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcImZldGNoTmVpZ2hib3Job29kc1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaE5laWdoYm9yaG9vZHMoKSB7XG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICAgIHJldHVybiB0aGlzLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50cykge1xuICAgICAgICB2YXIgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcChmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICAgIHJldHVybiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2Q7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbmVpZ2hib3Job29kcy5maWx0ZXIoZnVuY3Rpb24gKHYsIGkpIHtcbiAgICAgICAgICByZXR1cm4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09PSBpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJmZXRjaEN1aXNpbmVzXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGZldGNoQ3Vpc2luZXMoKSB7XG4gICAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICAgIHJldHVybiB0aGlzLmZldGNoUmVzdGF1cmFudHMoKS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50cykge1xuICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG4gICAgICAgIHZhciBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcChmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICAgIHJldHVybiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGU7XG4gICAgICAgIH0pOyAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXG5cbiAgICAgICAgcmV0dXJuIGN1aXNpbmVzLmZpbHRlcihmdW5jdGlvbiAodiwgaSkge1xuICAgICAgICAgIHJldHVybiBjdWlzaW5lcy5pbmRleE9mKHYpID09PSBpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxuICAgICAqL1xuXG4gIH0sIHtcbiAgICBrZXk6IFwidXJsRm9yUmVzdGF1cmFudFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICAgIHJldHVybiBcIi4vcmVzdGF1cmFudC5odG1sP2lkPVwiLmNvbmNhdChyZXN0YXVyYW50LmlkKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJpbWFnZVVybEZvclJlc3RhdXJhbnRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHR5cGUpIHtcbiAgICAgIHJldHVybiB0eXBlID8gXCIvaW1nL3RodW1icy9cIi5jb25jYXQocmVzdGF1cmFudC5pZCwgXCItMjQ4LmpwZ1wiKSA6IFwiL2ltZy9cIi5jb25jYXQocmVzdGF1cmFudC5pZCwgXCIud2VicFwiKTtcbiAgICB9IC8vIEZldGNoIHJldmlld3MgYnkgSWQuXG5cbiAgfSwge1xuICAgIGtleTogXCJmZXRjaFJldmlld3NCeVJlc3RJZFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBmZXRjaFJldmlld3NCeVJlc3RJZChyZXN0YXVyYW50SWQpIHtcbiAgICAgIHZhciBEQnVybCA9IHRoaXMuZGF0YUJhc2VVcmxzKCkucmVzdGF1cmFudFJldmlld3MocmVzdGF1cmFudElkKTtcbiAgICAgIHJldHVybiBmZXRjaChEQnVybCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJldmlld3MpIHtcbiAgICAgICAgaWRiS2V5dmFsLnNldChSRVZJRVdTX1NUT1JFLCBOdW1iZXIocmVzdGF1cmFudElkKSwgcmV2aWV3cyk7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmV2aWV3cyk7XG4gICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBpZGJLZXl2YWwuZ2V0SXRlbXMoUkVWSUVXU19TVE9SRSwgTnVtYmVyKHJlc3RhdXJhbnRJZCksICdyZXN0YXVyYW50cycpLnRoZW4oZnVuY3Rpb24gKHJldmlld3MpIHtcbiAgICAgICAgICAvL2NvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmV2aWV3cyk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiBcIm1hcE1hcmtlckZvclJlc3RhdXJhbnRcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcbiAgICAgIHZhciBtYXJrZXIgPSBMLm1hcmtlcihbcmVzdGF1cmFudC5sYXRsbmcubGF0LCByZXN0YXVyYW50LmxhdGxuZy5sbmddLCB7XG4gICAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXG4gICAgICAgIGJvdW5jZU9uQWRkOiB0cnVlLFxuICAgICAgICBib3VuY2VPbkFkZE9wdGlvbnM6IHtcbiAgICAgICAgICBkdXJhdGlvbjogNTAwLFxuICAgICAgICAgIGhlaWdodDogMTAwXG4gICAgICAgIH1cbiAgICAgIH0pLmFkZFRvKG1hcCk7XG4gICAgICBtYXJrZXIuYmluZFBvcHVwKFwiPGEgaHJlZj1cXFwiXCIuY29uY2F0KHRoaXMudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSwgXCJcXFwiPlwiKS5jb25jYXQocmVzdGF1cmFudC5uYW1lLCBcIjwvYT5cIikpO1xuICAgICAgcmV0dXJuIG1hcmtlcjtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwiYWRkUmV2aWV3XCIsXG5cbiAgICAvKipcbiAgICAgKlxuICAgICAqL1xuICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRSZXZpZXcocmV2aWV3KSB7XG4gICAgICByZXR1cm4gREJIZWxwZXIuYWRkT25saW5lUmV2aWV3KHJldmlldyk7XG4gICAgfVxuICB9XSwgW3tcbiAgICBrZXk6IFwiZGJQcm9taXNlXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRiUHJvbWlzZSgpIHtcbiAgICAgIHJldHVybiBfaWRiLmRlZmF1bHQub3BlbihEQVRBQkFTRSwgMSwgZnVuY3Rpb24gKHVwZ3JhZGVEYikge1xuICAgICAgICBpZiAoIXVwZ3JhZGVEYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKFJFU1RBVVJBTlRTX1NUT1JFKSkge1xuICAgICAgICAgIHZhciBzdG9yZSA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZShSRVNUQVVSQU5UU19TVE9SRSwge1xuICAgICAgICAgICAga2V5UGF0aDogJ2lkJ1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHN0b3JlLmNyZWF0ZUluZGV4KCdieS1pZCcsICdpZCcpO1xuICAgICAgICAgIHN0b3JlLmNyZWF0ZUluZGV4KCdzeW5jZWQnLCAnc3luY2VkJywge1xuICAgICAgICAgICAgdW5pcXVlOiBmYWxzZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF1cGdyYWRlRGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhSRVZJRVdTX1NUT1JFKSkge1xuICAgICAgICAgIHZhciByZXZpZXdzID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKFJFVklFV1NfU1RPUkUsIHtcbiAgICAgICAgICAgIGtleVBhdGg6ICdpZCdcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXZpZXdzLmNyZWF0ZUluZGV4KCdieS1pZCcsICdpZCcpO1xuICAgICAgICAgIHJldmlld3MuY3JlYXRlSW5kZXgoJ3Jlc3RhdXJhbnRzJywgJ3Jlc3RhdXJhbnRfaWQnLCB7XG4gICAgICAgICAgICB1bmlxdWU6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV2aWV3cy5jcmVhdGVJbmRleCgnc3luY2VkJywgJ3N5bmNlZCcsIHtcbiAgICAgICAgICAgIHVuaXF1ZTogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBpbmRleGVkREIgYW5kIGFkZCB0aGUgaXRlbXMgZnJvbSB0aGUgc2VydmVyXG4gICAgICovXG5cbiAgfSwge1xuICAgIGtleTogXCJhZGRJbmRleGVkRGJcIixcbiAgICB2YWx1ZTogZnVuY3Rpb24gYWRkSW5kZXhlZERiKHR5cGUsIGl0ZW1zKSB7XG4gICAgICBEQkhlbHBlci5kYlByb21pc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xuICAgICAgICB2YXIgdHggPSBkYi50cmFuc2FjdGlvbih0eXBlLCAncmVhZHdyaXRlJyk7XG4gICAgICAgIHZhciBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKHR5cGUpO1xuICAgICAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgcmV0dXJuIHN0b3JlLnB1dChpdGVtKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0eC5jb21wbGV0ZS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGl0ZW1zKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9IC8vIEdldCBzdG9yZWQgb2JqZWN0IGJ5IElkLlxuXG4gIH0sIHtcbiAgICBrZXk6IFwiZ2V0U3RvcmVkT2JqZWN0QnlJZFwiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTdG9yZWRPYmplY3RCeUlkKGRiU2VydmljZSwgc3RvcmVuYW1lLCBpZCkge1xuICAgICAgdmFyIHN0b3JlID0gZ2V0U3RvcmUoc3RvcmVuYW1lKShkYlNlcnZpY2UpO1xuICAgICAgcmV0dXJuIHN0b3JlLmdldChpZCk7XG4gICAgfVxuICB9LCB7XG4gICAga2V5OiBcImFkZE9ubGluZVJldmlld1wiLFxuICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRPbmxpbmVSZXZpZXcocmV2aWV3KSB7XG4gICAgICB2YXIgb2ZmbGluZU9iaiA9IHtcbiAgICAgICAgbmFtZTogJ2FkZFJldmlldycsXG4gICAgICAgIGRhdGE6IHJldmlldyxcbiAgICAgICAgb2JqZWN0X3R5cGU6ICdyZXZpZXcnXG4gICAgICB9O1xuXG4gICAgICBpZiAoIW5hdmlnYXRvci5vbkxpbmUgJiYgb2ZmbGluZU9iai5uYW1lID09PSAnYWRkUmV2aWV3Jykge1xuICAgICAgICBEQkhlbHBlci5zZW5kRGF0YVdoZW5PbmxpbmUob2ZmbGluZU9iaik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIHNlbmRSZXZpZXcgPSB7XG4gICAgICAgICdyZXN0YXVyYW50X2lkJzogcGFyc2VJbnQocmV2aWV3LnJlc3RhdXJhbnRfaWQpLFxuICAgICAgICAnbmFtZSc6IHJldmlldy5uYW1lLFxuICAgICAgICAnY3JlYXRlZEF0JzogbmV3IERhdGUoKSxcbiAgICAgICAgJ3VwZGF0ZWRBdCc6IG5ldyBEYXRlKCksXG4gICAgICAgICdyYXRpbmcnOiBwYXJzZUludChyZXZpZXcucmF0aW5nKSxcbiAgICAgICAgJ2NvbW1lbnRzJzogcmV2aWV3LmNvbW1lbnRzXG4gICAgICB9O1xuICAgICAgdmFyIGZldGNoX29wdGlvbiA9IHtcbiAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHNlbmRSZXZpZXcpLFxuICAgICAgICBoZWFkZXJzOiBuZXcgSGVhZGVycyh7XG4gICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICB9KVxuICAgICAgfTtcbiAgICAgIHZhciBEQnVybCA9ICdodHRwOi8vbG9jYWxob3N0OjEzMzcvcmV2aWV3cy8nO1xuICAgICAgZmV0Y2goREJ1cmwsIGZldGNoX29wdGlvbikudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdjb250ZW50LXR5cGUnKS5pbmRleE9mKCdhcHBsaWNhdGlvbi9qc29uJykgPiAtMSkge1xuICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuICdBUEkgY2FsbCBzdWNjZWVkZWQnO1xuICAgICAgICB9XG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICByZXR1cm4gXCJFcnJvcjogXCIuY29uY2F0KGVycik7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sIHtcbiAgICBrZXk6IFwic2VuZERhdGFXaGVuT25saW5lXCIsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIHNlbmREYXRhV2hlbk9ubGluZShvZmZsaW5lT2JqKSB7XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZGF0YScsIEpTT04uc3RyaW5naWZ5KG9mZmxpbmVPYmouZGF0YSkpO1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2RhdGEnKSk7XG5cbiAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICBpZiAob2ZmbGluZU9iai5uYW1lID09PSAnYWRkUmV2aWV3Jykge1xuICAgICAgICAgICAgREJIZWxwZXIuYWRkT25saW5lUmV2aWV3KG9mZmxpbmVPYmouZGF0YSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2RhdGEnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gREJIZWxwZXI7XG59KCk7XG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgZGlzcGxheVRvYXN0KGV2ZW50LnR5cGUpO1xufSk7XG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb2ZmbGluZScsIGZ1bmN0aW9uIChldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICBkaXNwbGF5VG9hc3QoZXZlbnQudHlwZSk7XG59KTtcblxudmFyIGRpc3BsYXlUb2FzdCA9IGZ1bmN0aW9uIGRpc3BsYXlUb2FzdCh0eXBlKSB7XG4gIHZhciBtZXNzYWdlID0gJzxzcGFuPlVuYWJsZSB0byBjb25uZWN0LiBSZXRyeWluZ+KApjwvc3Bhbj4nLFxuICAgICAgaXNWaXNpYmxlID0gJ25vbmUnO1xuXG4gIGlmICh0eXBlID09PSAnb25saW5lJykge1xuICAgIGlzVmlzaWJsZSA9ICdub25lJztcbiAgfSBlbHNlIHtcbiAgICBpc1Zpc2libGUgPSAnYmxvY2snO1xuICB9XG5cbiAgdmFyIHRvYXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3RvYXN0Jyk7XG4gIHRvYXN0LmlubmVySFRNTCA9IG1lc3NhZ2U7XG4gIHRvYXN0LnN0eWxlLmRpc3BsYXkgPSBpc1Zpc2libGU7XG59O1xuXG52YXIgX2RlZmF1bHQgPSBuZXcgREJIZWxwZXIoKTtcblxuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../src/js/dbhelper.js\n")},"../src/js/restaurant_info.js":function(module,exports,__webpack_require__){"use strict";eval("\n\nvar _dbhelper = _interopRequireDefault(__webpack_require__(\"../src/js/dbhelper.js\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/*global L*/\nvar endpoint = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}';\nvar attribution = 'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, ' + '<a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, ' + 'Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>';\ndocument.addEventListener('DOMContentLoaded', function () {\n  window.initMap(); // added\n});\n/**\n * Initialize map, called from HTML.\n */\n\nwindow.initMap = function () {\n  fetchRestaurantFromURL().then(function (restaurant) {\n    fillBreadcrumb(restaurant); //if(L === undefined) return;\n\n    self.newMap = L.map('map', {\n      center: [restaurant.latlng.lat, restaurant.latlng.lng],\n      zoom: 16,\n      scrollWheelZoom: false\n    });\n    /*eslint no-undef: \"error\"*/\n\n    L.tileLayer(endpoint, {\n      mapboxToken: 'pk.eyJ1IjoiYWJvZGEiLCJhIjoiY2prY3oxYnhoMzB2cDNrbWV0bmcydW5qdiJ9.LTC-ZvmDbMhyD5aEM9OO_Q',\n      maxZoom: 18,\n      attribution: attribution,\n      id: 'mapbox.streets'\n    }).addTo(self.newMap);\n\n    _dbhelper.default.mapMarkerForRestaurant(restaurant, self.newMap);\n  }).catch(function (err) {\n    return console.error(err);\n  });\n};\n/**\n * Get current restaurant from page URL.\n */\n\n\nvar fetchRestaurantFromURL = function fetchRestaurantFromURL(restaurant) {\n  if (restaurant) {\n    // restaurant already fetched!\n    return Promise.resolve(restaurant);\n  }\n\n  var id = getParameterByName('id');\n\n  if (!id) {\n    // no id found in URL\n    var error = 'No restaurant id in URL';\n    return Promise.reject(error);\n  } else {\n    return _dbhelper.default.fetchRestaurantById(id).then(function (restaurant) {\n      fillRestaurantHTML(restaurant);\n      return restaurant;\n    }).catch(function (err) {\n      return console.error(err);\n    });\n  }\n};\n/**\n * Create restaurant HTML and add it to the webpage\n */\n\n\nvar fillRestaurantHTML = function fillRestaurantHTML(restaurant) {\n  var name = document.getElementById('restaurant-name');\n  name.innerHTML = restaurant.name;\n  var address = document.getElementById('restaurant-address');\n  address.innerHTML = restaurant.address;\n  var image = document.getElementById('restaurant-img');\n  image.className = 'restaurant-img';\n  image.src = _dbhelper.default.imageUrlForRestaurant(restaurant);\n  image.alt = \"Restaurant \".concat(restaurant.name);\n  var cuisine = document.getElementById('restaurant-cuisine');\n  cuisine.innerHTML = restaurant.cuisine_type; // fill operating hours\n\n  if (restaurant.operating_hours) {\n    fillRestaurantHoursHTML(restaurant.operating_hours);\n  } // Fill reviews.\n\n\n  _dbhelper.default.fetchReviewsByRestId(restaurant.id).then(function (reviews) {\n    fillReviewsHTML(reviews);\n  });\n};\n/**\n * Create restaurant operating hours HTML table and add it to the webpage.\n */\n\n\nvar fillRestaurantHoursHTML = function fillRestaurantHoursHTML(operatingHours) {\n  var hours = document.getElementById('restaurant-hours');\n\n  for (var key in operatingHours) {\n    var row = document.createElement('tr');\n    var day = document.createElement('td');\n    day.innerHTML = key;\n    row.appendChild(day);\n    var time = document.createElement('td');\n    time.innerHTML = operatingHours[key];\n    row.appendChild(time);\n    hours.appendChild(row);\n  }\n};\n/**\n * Create all reviews HTML and add them to the webpage.\n */\n\n\nvar fillReviewsHTML = function fillReviewsHTML(reviews) {\n  var container = document.getElementById('reviews-container');\n  var title = document.createElement('h4');\n  title.innerHTML = 'Reviews';\n  container.appendChild(title);\n\n  if (!reviews) {\n    var noReviews = document.createElement('p');\n    noReviews.innerHTML = 'No reviews yet!';\n    container.appendChild(noReviews);\n    return;\n  }\n\n  var ul = document.getElementById('reviews-list');\n\n  if (!Array.isArray(reviews)) {\n    reviews = [reviews];\n  }\n\n  reviews.forEach(function (review) {\n    ul.appendChild(createReviewHTML(review));\n  });\n  container.appendChild(ul);\n};\n/**\n * Create review HTML and add it to the webpage.\n */\n\n\nvar createReviewHTML = function createReviewHTML(review) {\n  var li = document.createElement('li');\n\n  if (!navigator.onLine) {\n    var connection_status = document.createElement('p');\n    connection_status.classList.add('offline_label');\n    connection_status.innerHTML = 'Offline';\n    li.classList.add('reviews_offline');\n    li.appendChild(connection_status);\n  }\n\n  var name = document.createElement('p');\n  name.className = 'reviewer';\n  name.innerHTML = review.name;\n  li.appendChild(name);\n  var date = document.createElement('p');\n  date.className = 'review-date';\n  date.innerHTML = \"Date: \".concat(new Date(review.createdAt).toLocaleString());\n  li.appendChild(date);\n  var rating = document.createElement('p');\n  rating.innerHTML = \"Rating: \".concat(review.rating);\n  rating.className = 'review-rating';\n  li.appendChild(rating);\n  var comments = document.createElement('p');\n  comments.innerHTML = review.comments;\n  comments.className = 'review-comment';\n  li.appendChild(comments);\n  return li;\n}; // Review form validation and submission.\n\n\nvar addReview = function addReview() {\n  event.preventDefault(); // Get the review data from the form.\n\n  var restaurantId = getParameterByName('id');\n  var name = document.getElementById('review-author').value;\n  var rating;\n  var comments = document.getElementById('review-comments').value;\n  rating = document.querySelector('#rating_select option:checked').value;\n  var review = [name, rating, comments, restaurantId];\n\n  if (checkEmptyFields(review)) {\n    // Add the review data to the DOM.\n    var frontEndReview = {\n      restaurant_id: parseInt(review[3]),\n      rating: parseInt(review[1]),\n      name: review[0],\n      comments: review[2].substring(0, 300),\n      createdAt: new Date()\n    }; // Send the review to the backend.\n\n    _dbhelper.default.addReview(frontEndReview);\n\n    addReviewHTML(frontEndReview);\n    document.getElementById('review-form').reset();\n  }\n};\n\nvar checkEmptyFields = function checkEmptyFields(formInputs) {\n  var valid = true;\n  var message_container = document.querySelector('#form-error');\n  message_container.innerHTML = '';\n\n  if (formInputs[0] === '' || formInputs[1] < 1 || formInputs[1] > 5 || formInputs[1] === '' || formInputs[2] === '') {\n    valid = false;\n    message_container.innerHTML = 'Please fill above empty field !';\n    message_container.setAttribute('role', 'alert');\n    message_container.setAttribute('aria-live', 'assertive');\n  }\n\n  message_container.classList.toggle('hidden', valid);\n  return valid;\n}; // Add the review to the UI.\n\n\nvar addReviewHTML = function addReviewHTML(review) {\n  if (document.getElementById('no-review')) {\n    document.getElementById('no-review').remove();\n  }\n\n  var container = document.getElementById('reviews-container');\n  var ul = document.getElementById('reviews-list'); // Insert the new review on the top.\n\n  ul.insertBefore(createReviewHTML(review), ul.firstChild);\n  container.appendChild(ul);\n};\n/**\n * Add restaurant name to the breadcrumb navigation menu\n */\n\n\nvar fillBreadcrumb = function fillBreadcrumb(restaurant) {\n  var breadcrumb = document.getElementById('breadcrumb');\n  var li = document.createElement('li');\n  li.innerHTML = restaurant.name;\n  breadcrumb.appendChild(li);\n};\n/**\n * Get a parameter by name from page URL.\n */\n\n\nvar getParameterByName = function getParameterByName(name, url) {\n  if (!url) url = window.location.href;\n  name = name.replace(/[\\]]/g, '\\\\$&');\n  var regex = new RegExp(\"[?&]\".concat(name, \"(=([^&#]*)|&|#|$)\"));\n  var results = regex.exec(url);\n  if (!results) return null;\n  if (!results[2]) return '';\n  return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n};\n\nwindow.addReview = addReview;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vc3JjL2pzL3Jlc3RhdXJhbnRfaW5mby5qcy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uLi9zcmMvanMvcmVzdGF1cmFudF9pbmZvLmpzP2FkODciXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBfZGJoZWxwZXIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL2RiaGVscGVyXCIpKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuLypnbG9iYWwgTCovXG52YXIgZW5kcG9pbnQgPSAnaHR0cHM6Ly9hcGkudGlsZXMubWFwYm94LmNvbS92NC97aWR9L3t6fS97eH0ve3l9LmpwZzcwP2FjY2Vzc190b2tlbj17bWFwYm94VG9rZW59JztcbnZhciBhdHRyaWJ1dGlvbiA9ICdNYXAgZGF0YSAmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL1wiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycywgJyArICc8YSBocmVmPVwiaHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LXNhLzIuMC9cIj5DQy1CWS1TQTwvYT4sICcgKyAnSW1hZ2VyeSDCqSA8YSBocmVmPVwiaHR0cHM6Ly93d3cubWFwYm94LmNvbS9cIj5NYXBib3g8L2E+JztcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbiAoKSB7XG4gIHdpbmRvdy5pbml0TWFwKCk7IC8vIGFkZGVkXG59KTtcbi8qKlxuICogSW5pdGlhbGl6ZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cblxud2luZG93LmluaXRNYXAgPSBmdW5jdGlvbiAoKSB7XG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50KSB7XG4gICAgZmlsbEJyZWFkY3J1bWIocmVzdGF1cmFudCk7IC8vaWYoTCA9PT0gdW5kZWZpbmVkKSByZXR1cm47XG5cbiAgICBzZWxmLm5ld01hcCA9IEwubWFwKCdtYXAnLCB7XG4gICAgICBjZW50ZXI6IFtyZXN0YXVyYW50LmxhdGxuZy5sYXQsIHJlc3RhdXJhbnQubGF0bG5nLmxuZ10sXG4gICAgICB6b29tOiAxNixcbiAgICAgIHNjcm9sbFdoZWVsWm9vbTogZmFsc2VcbiAgICB9KTtcbiAgICAvKmVzbGludCBuby11bmRlZjogXCJlcnJvclwiKi9cblxuICAgIEwudGlsZUxheWVyKGVuZHBvaW50LCB7XG4gICAgICBtYXBib3hUb2tlbjogJ3BrLmV5SjFJam9pWVdKdlpHRWlMQ0poSWpvaVkycHJZM294WW5ob016QjJjRE5yYldWMGJtY3lkVzVxZGlKOS5MVEMtWnZtRGJNaHlENWFFTTlPT19RJyxcbiAgICAgIG1heFpvb206IDE4LFxuICAgICAgYXR0cmlidXRpb246IGF0dHJpYnV0aW9uLFxuICAgICAgaWQ6ICdtYXBib3guc3RyZWV0cydcbiAgICB9KS5hZGRUbyhzZWxmLm5ld01hcCk7XG5cbiAgICBfZGJoZWxwZXIuZGVmYXVsdC5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubmV3TWFwKTtcbiAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgIHJldHVybiBjb25zb2xlLmVycm9yKGVycik7XG4gIH0pO1xufTtcbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICovXG5cblxudmFyIGZldGNoUmVzdGF1cmFudEZyb21VUkwgPSBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKHJlc3RhdXJhbnQpIHtcbiAgaWYgKHJlc3RhdXJhbnQpIHtcbiAgICAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3RhdXJhbnQpO1xuICB9XG5cbiAgdmFyIGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuXG4gIGlmICghaWQpIHtcbiAgICAvLyBubyBpZCBmb3VuZCBpbiBVUkxcbiAgICB2YXIgZXJyb3IgPSAnTm8gcmVzdGF1cmFudCBpZCBpbiBVUkwnO1xuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIF9kYmhlbHBlci5kZWZhdWx0LmZldGNoUmVzdGF1cmFudEJ5SWQoaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnQpIHtcbiAgICAgIGZpbGxSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KTtcbiAgICAgIHJldHVybiByZXN0YXVyYW50O1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgIHJldHVybiBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSk7XG4gIH1cbn07XG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5cblxudmFyIGZpbGxSZXN0YXVyYW50SFRNTCA9IGZ1bmN0aW9uIGZpbGxSZXN0YXVyYW50SFRNTChyZXN0YXVyYW50KSB7XG4gIHZhciBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xuICBuYW1lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgdmFyIGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuICB2YXIgaW1hZ2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1pbWcnKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcbiAgaW1hZ2Uuc3JjID0gX2RiaGVscGVyLmRlZmF1bHQuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBpbWFnZS5hbHQgPSBcIlJlc3RhdXJhbnQgXCIuY29uY2F0KHJlc3RhdXJhbnQubmFtZSk7XG4gIHZhciBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlOyAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKTtcbiAgfSAvLyBGaWxsIHJldmlld3MuXG5cblxuICBfZGJoZWxwZXIuZGVmYXVsdC5mZXRjaFJldmlld3NCeVJlc3RJZChyZXN0YXVyYW50LmlkKS50aGVuKGZ1bmN0aW9uIChyZXZpZXdzKSB7XG4gICAgZmlsbFJldmlld3NIVE1MKHJldmlld3MpO1xuICB9KTtcbn07XG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXG4gKi9cblxuXG52YXIgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSBmdW5jdGlvbiBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTChvcGVyYXRpbmdIb3Vycykge1xuICB2YXIgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuXG4gIGZvciAodmFyIGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuICAgIHZhciByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuICAgIHZhciBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XG4gICAgdmFyIHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XG4gICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcbiAgfVxufTtcbi8qKlxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5cblxudmFyIGZpbGxSZXZpZXdzSFRNTCA9IGZ1bmN0aW9uIGZpbGxSZXZpZXdzSFRNTChyZXZpZXdzKSB7XG4gIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcbiAgdmFyIHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDQnKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xuXG4gIGlmICghcmV2aWV3cykge1xuICAgIHZhciBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcblxuICBpZiAoIUFycmF5LmlzQXJyYXkocmV2aWV3cykpIHtcbiAgICByZXZpZXdzID0gW3Jldmlld3NdO1xuICB9XG5cbiAgcmV2aWV3cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXZpZXcpIHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICB9KTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbn07XG4vKipcbiAqIENyZWF0ZSByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5cblxudmFyIGNyZWF0ZVJldmlld0hUTUwgPSBmdW5jdGlvbiBjcmVhdGVSZXZpZXdIVE1MKHJldmlldykge1xuICB2YXIgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuXG4gIGlmICghbmF2aWdhdG9yLm9uTGluZSkge1xuICAgIHZhciBjb25uZWN0aW9uX3N0YXR1cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBjb25uZWN0aW9uX3N0YXR1cy5jbGFzc0xpc3QuYWRkKCdvZmZsaW5lX2xhYmVsJyk7XG4gICAgY29ubmVjdGlvbl9zdGF0dXMuaW5uZXJIVE1MID0gJ09mZmxpbmUnO1xuICAgIGxpLmNsYXNzTGlzdC5hZGQoJ3Jldmlld3Nfb2ZmbGluZScpO1xuICAgIGxpLmFwcGVuZENoaWxkKGNvbm5lY3Rpb25fc3RhdHVzKTtcbiAgfVxuXG4gIHZhciBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBuYW1lLmNsYXNzTmFtZSA9ICdyZXZpZXdlcic7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xuICB2YXIgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgZGF0ZS5jbGFzc05hbWUgPSAncmV2aWV3LWRhdGUnO1xuICBkYXRlLmlubmVySFRNTCA9IFwiRGF0ZTogXCIuY29uY2F0KG5ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpLnRvTG9jYWxlU3RyaW5nKCkpO1xuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcbiAgdmFyIHJhdGluZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgcmF0aW5nLmlubmVySFRNTCA9IFwiUmF0aW5nOiBcIi5jb25jYXQocmV2aWV3LnJhdGluZyk7XG4gIHJhdGluZy5jbGFzc05hbWUgPSAncmV2aWV3LXJhdGluZyc7XG4gIGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XG4gIHZhciBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBjb21tZW50cy5jbGFzc05hbWUgPSAncmV2aWV3LWNvbW1lbnQnO1xuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XG4gIHJldHVybiBsaTtcbn07IC8vIFJldmlldyBmb3JtIHZhbGlkYXRpb24gYW5kIHN1Ym1pc3Npb24uXG5cblxudmFyIGFkZFJldmlldyA9IGZ1bmN0aW9uIGFkZFJldmlldygpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gR2V0IHRoZSByZXZpZXcgZGF0YSBmcm9tIHRoZSBmb3JtLlxuXG4gIHZhciByZXN0YXVyYW50SWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XG4gIHZhciBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlldy1hdXRob3InKS52YWx1ZTtcbiAgdmFyIHJhdGluZztcbiAgdmFyIGNvbW1lbnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlldy1jb21tZW50cycpLnZhbHVlO1xuICByYXRpbmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcmF0aW5nX3NlbGVjdCBvcHRpb246Y2hlY2tlZCcpLnZhbHVlO1xuICB2YXIgcmV2aWV3ID0gW25hbWUsIHJhdGluZywgY29tbWVudHMsIHJlc3RhdXJhbnRJZF07XG5cbiAgaWYgKGNoZWNrRW1wdHlGaWVsZHMocmV2aWV3KSkge1xuICAgIC8vIEFkZCB0aGUgcmV2aWV3IGRhdGEgdG8gdGhlIERPTS5cbiAgICB2YXIgZnJvbnRFbmRSZXZpZXcgPSB7XG4gICAgICByZXN0YXVyYW50X2lkOiBwYXJzZUludChyZXZpZXdbM10pLFxuICAgICAgcmF0aW5nOiBwYXJzZUludChyZXZpZXdbMV0pLFxuICAgICAgbmFtZTogcmV2aWV3WzBdLFxuICAgICAgY29tbWVudHM6IHJldmlld1syXS5zdWJzdHJpbmcoMCwgMzAwKSxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKVxuICAgIH07IC8vIFNlbmQgdGhlIHJldmlldyB0byB0aGUgYmFja2VuZC5cblxuICAgIF9kYmhlbHBlci5kZWZhdWx0LmFkZFJldmlldyhmcm9udEVuZFJldmlldyk7XG5cbiAgICBhZGRSZXZpZXdIVE1MKGZyb250RW5kUmV2aWV3KTtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3LWZvcm0nKS5yZXNldCgpO1xuICB9XG59O1xuXG52YXIgY2hlY2tFbXB0eUZpZWxkcyA9IGZ1bmN0aW9uIGNoZWNrRW1wdHlGaWVsZHMoZm9ybUlucHV0cykge1xuICB2YXIgdmFsaWQgPSB0cnVlO1xuICB2YXIgbWVzc2FnZV9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZm9ybS1lcnJvcicpO1xuICBtZXNzYWdlX2NvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcblxuICBpZiAoZm9ybUlucHV0c1swXSA9PT0gJycgfHwgZm9ybUlucHV0c1sxXSA8IDEgfHwgZm9ybUlucHV0c1sxXSA+IDUgfHwgZm9ybUlucHV0c1sxXSA9PT0gJycgfHwgZm9ybUlucHV0c1syXSA9PT0gJycpIHtcbiAgICB2YWxpZCA9IGZhbHNlO1xuICAgIG1lc3NhZ2VfY29udGFpbmVyLmlubmVySFRNTCA9ICdQbGVhc2UgZmlsbCBhYm92ZSBlbXB0eSBmaWVsZCAhJztcbiAgICBtZXNzYWdlX2NvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYWxlcnQnKTtcbiAgICBtZXNzYWdlX2NvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGl2ZScsICdhc3NlcnRpdmUnKTtcbiAgfVxuXG4gIG1lc3NhZ2VfY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicsIHZhbGlkKTtcbiAgcmV0dXJuIHZhbGlkO1xufTsgLy8gQWRkIHRoZSByZXZpZXcgdG8gdGhlIFVJLlxuXG5cbnZhciBhZGRSZXZpZXdIVE1MID0gZnVuY3Rpb24gYWRkUmV2aWV3SFRNTChyZXZpZXcpIHtcbiAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduby1yZXZpZXcnKSkge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduby1yZXZpZXcnKS5yZW1vdmUoKTtcbiAgfVxuXG4gIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcbiAgdmFyIHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpOyAvLyBJbnNlcnQgdGhlIG5ldyByZXZpZXcgb24gdGhlIHRvcC5cblxuICB1bC5pbnNlcnRCZWZvcmUoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpLCB1bC5maXJzdENoaWxkKTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbn07XG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cblxuXG52YXIgZmlsbEJyZWFkY3J1bWIgPSBmdW5jdGlvbiBmaWxsQnJlYWRjcnVtYihyZXN0YXVyYW50KSB7XG4gIHZhciBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcbiAgdmFyIGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBicmVhZGNydW1iLmFwcGVuZENoaWxkKGxpKTtcbn07XG4vKipcbiAqIEdldCBhIHBhcmFtZXRlciBieSBuYW1lIGZyb20gcGFnZSBVUkwuXG4gKi9cblxuXG52YXIgZ2V0UGFyYW1ldGVyQnlOYW1lID0gZnVuY3Rpb24gZ2V0UGFyYW1ldGVyQnlOYW1lKG5hbWUsIHVybCkge1xuICBpZiAoIXVybCkgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXF1dL2csICdcXFxcJCYnKTtcbiAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cChcIls/Jl1cIi5jb25jYXQobmFtZSwgXCIoPShbXiYjXSopfCZ8I3wkKVwiKSk7XG4gIHZhciByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpIHJldHVybiBudWxsO1xuICBpZiAoIXJlc3VsdHNbMl0pIHJldHVybiAnJztcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn07XG5cbndpbmRvdy5hZGRSZXZpZXcgPSBhZGRSZXZpZXc7Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///../src/js/restaurant_info.js\n")}});